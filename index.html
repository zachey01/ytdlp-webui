<!DOCTYPE html>
<html>
  <head>
    <title>YouTube Video Downloader</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        function displayUrl(res) {
          let videoPlayer = document.createElement("video");
          document.body.appendChild(videoPlayer);
          $(videoPlayer).attr("controls", "true");

          videoPlayer.src = res;
        }

        $("form").submit(function (event) {
          event.preventDefault(); // предотвращаем перезагрузку страницы

          var url = $("input[name='url']").val(); // получаем значение поля ввода

          // Проверяем, является ли введенное значение ссылкой
          if (isValidUrl(url)) {
            // отправляем AJAX запрос на сервер
            $.ajax({
              url: "/download",
              type: "POST",
              data: { url: url },
              success: function (response) {
                displayUrl(response);
                console.log(response);
              },
            });
          } else {
            console.log("Ошибка: Введенное значение не является ссылкой");
          }
        });

        // Функция для проверки, является ли строка ссылкой
        function isValidUrl(string) {
          // Регулярное выражение для проверки ссылки
          var urlPattern = new RegExp(
            "^(https?:\\/\\/)?" + // протокол
              "((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|" + // доменное имя
              "((\\d{1,3}\\.){3}\\d{1,3}))" + // IP (IPv4) адрес
              "(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*" + // порт и путь
              "(\\?[;&a-z\\d%_.~+=-]*)?" + // параметры запроса
              "(\\#[-a-z\\d_]*)?$",
            "i"
          ); // фрагмент (якорь)

          return urlPattern.test(string);
        }
      });
    </script>
  </head>
  <body>
    <h1>YouTube Video Downloader</h1>
    <form>
      <input
        type="text"
        name="url"
        placeholder="Enter YouTube video URL"
        required
      />
      <button type="submit">Download</button>
    </form>
  </body>
</html>
